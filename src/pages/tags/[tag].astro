---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getAllTags, getPostsByTag } from '../../utils/posts';

export const getStaticPaths = (async () => {
  const tags = await getAllTags();
  return [...tags.keys()].map((tag) => ({ params: { tag } }));
}) satisfies GetStaticPaths;

const { tag } = Astro.params;
const posts = await getPostsByTag(tag);
---

<BaseLayout title={`Posts tagged "${tag}" â€” Vladyslav Semenchenko`} description={`All posts tagged with ${tag}.`}>
  <section class="mx-auto max-w-5xl px-4 pt-12 pb-12 sm:pt-16 sm:pb-16">
    <div class="flex items-center gap-4">
      <a
        href="/tags"
        class="text-sm text-accent-600 hover:text-accent-700 dark:text-accent-400 dark:hover:text-accent-300"
      >
        &larr; All tags
      </a>
    </div>
    <h1 class="mt-4 text-3xl font-bold tracking-tight text-zinc-900 dark:text-zinc-100 sm:text-4xl">
      #{tag}
    </h1>
    <p class="mt-2 text-zinc-600 dark:text-zinc-400">
      {posts.length} post{posts.length !== 1 ? 's' : ''} tagged with "{tag}".
    </p>

    <div class="mt-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {posts.map((post) => (
        <PostCard post={post} />
      ))}
    </div>
  </section>
</BaseLayout>
