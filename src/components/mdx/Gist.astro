---
interface Props {
  id: string;
  file?: string;
}

const { id, file } = Astro.props;

let content = '';
let filename = file || 'gist';
let language = '';

try {
  const url = `https://api.github.com/gists/${id}`;
  const response = await fetch(url);
  if (response.ok) {
    const data = await response.json();
    const files = data.files;
    const targetFile = file ? files[file] : Object.values(files)[0];
    if (targetFile) {
      content = (targetFile as any).content;
      filename = (targetFile as any).filename;
      language = (targetFile as any).language?.toLowerCase() || '';
    }
  }
} catch {
  content = '// Failed to load gist';
}
---

<div class="my-6">
  <div class="flex items-center justify-between rounded-t-lg border border-b-0 border-zinc-200 bg-zinc-100 px-4 py-2 dark:border-zinc-700 dark:bg-zinc-800">
    <span class="text-xs font-medium text-zinc-600 dark:text-zinc-400">{filename}</span>
    <a
      href={`https://gist.github.com/${id}`}
      target="_blank"
      rel="noopener noreferrer"
      class="text-xs text-accent-600 hover:text-accent-700 dark:text-accent-400 dark:hover:text-accent-300"
    >
      View on GitHub
    </a>
  </div>
  <pre class="!mt-0 !rounded-t-none"><code class={language ? `language-${language}` : ''}>{content}</code></pre>
</div>
